- name: Check {{ app_label }} {{ app_version }} executable checksum
  register: "exe_checksum_result"
  ansible.windows.win_stat:
    path: "{{ app_exe_path }}"
    get_checksum: yes
    checksum_algorithm: "{{ app_checksum_type }}"

- name: Download {{ app_label }} {{ app_version }}
  register: app_download_result
  when: exe_checksum_result.stat.exists == false or exe_checksum_result.stat.checksum != app_exe_checksum
  ansible.windows.win_get_url:
    url:                "{{ app_download_url }}"
    dest:               "{{ download_dir }}"
    checksum:           "{{ app_download_checksum }}"
    checksum_algorithm: "{{ app_checksum_type }}"
    force:              false

- name: Install {{ app_label }} {{ app_version }} executable
  ansible.windows.win_command: "{{ install_command }}"
  loop: "{{ app_install_commands }}"
  loop_control:
    loop_var: install_command
  when: exe_checksum_result.stat.exists == false or exe_checksum_result.stat.checksum != app_exe_checksum

